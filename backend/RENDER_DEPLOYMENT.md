# Render Deployment Guide for CarForum Backend

## Prerequisites
- GitHub account
- Render account (sign up at https://render.com)
- Cloudinary account for media storage

## Step 1: Prepare Your Repository

1. Make sure all changes are committed and pushed to GitHub:
   ```bash
   git add .
   git commit -m "Prepare backend for Render deployment"
   git push origin main
   ```

## Step 2: Create PostgreSQL Database on Render

1. Go to https://dashboard.render.com
2. Click **New +** → **PostgreSQL**
3. Configure:
   - **Name**: `carforum-db`
   - **Database**: `carforum`
   - **User**: `carforum`
   - **Region**: Choose closest to your users
   - **Plan**: Free (or paid for production)
4. Click **Create Database**
5. Wait for database to be created
6. **Save the Internal Database URL** (you'll need this)

## Step 3: Create Web Service on Render

1. Click **New +** → **Web Service**
2. Connect your GitHub repository
3. Configure the service:
   - **Name**: `carforum-backend`
   - **Region**: Same as database
   - **Branch**: `main`
   - **Root Directory**: `backend`
   - **Runtime**: `Python 3`
   - **Build Command**: `./build.sh`
   - **Start Command**: `gunicorn carforum_backend.wsgi:application`
   - **Plan**: Free (or paid for production)

## Step 4: Configure Environment Variables

In the Render dashboard, go to your web service → **Environment** and add:

### Required Variables:
```
SECRET_KEY = <click "Generate" to create a secure key>
DEBUG = False
ALLOWED_HOSTS = <your-app-name>.onrender.com
DATABASE_URL = <paste your PostgreSQL Internal Database URL>
```

### Cloudinary Variables (from your Cloudinary dashboard):
```
CLOUDINARY_CLOUD_NAME = <your-cloud-name>
CLOUDINARY_API_KEY = <your-api-key>
CLOUDINARY_API_SECRET = <your-api-secret>
```

### CORS Configuration:
```
CORS_ALLOWED_ORIGINS = https://your-frontend-domain.com,http://localhost:3000
```

## Step 5: Deploy

1. Click **Create Web Service**
2. Render will automatically:
   - Install dependencies
   - Collect static files
   - Run migrations
   - Start the server

3. Monitor the deployment logs for any errors

## Step 6: Verify Deployment

1. Once deployed, your backend will be available at:
   ```
   https://<your-app-name>.onrender.com
   ```

2. Test the API:
   ```
   https://<your-app-name>.onrender.com/api/topics/
   https://<your-app-name>.onrender.com/api/categories/
   ```

## Step 7: Create Superuser (Admin Account)

1. In Render dashboard, go to your web service → **Shell**
2. Run:
   ```bash
   python manage.py createsuperuser
   ```
3. Follow the prompts to create admin account
4. Access admin panel at: `https://<your-app-name>.onrender.com/admin/`

## Important Notes

### Free Tier Limitations:
- Services spin down after 15 minutes of inactivity
- First request after inactivity may take 30-60 seconds
- Database has storage limits

### For Production:
- Upgrade to paid plan for always-on service
- Use paid database for better performance
- Enable automatic backups
- Set up custom domain

### Security:
- Never commit `.env` files to GitHub
- Keep SECRET_KEY secure
- Use strong passwords
- Enable HTTPS (Render does this automatically)

## Troubleshooting

### Build Fails:
- Check build logs in Render dashboard
- Verify all dependencies in requirements.txt
- Ensure build.sh has execution permissions

### Database Connection Issues:
- Verify DATABASE_URL is correct
- Check if database is in same region
- Ensure database is running

### Static Files Not Loading:
- Run `python manage.py collectstatic` manually in Shell
- Check STATIC_ROOT and STATIC_URL settings
- Verify WhiteNoise is installed

### CORS Errors:
- Add frontend URL to CORS_ALLOWED_ORIGINS
- Include https:// or http:// prefix
- Separate multiple URLs with commas (no spaces)

## Updating Your Deployment

When you make changes:
```bash
git add .
git commit -m "Your changes"
git push origin main
```

Render will automatically detect changes and redeploy.

## Environment Variables Reference

| Variable | Description | Example |
|----------|-------------|---------|
| SECRET_KEY | Django secret key | Auto-generated by Render |
| DEBUG | Debug mode (always False in production) | False |
| ALLOWED_HOSTS | Comma-separated allowed hosts | myapp.onrender.com |
| DATABASE_URL | PostgreSQL connection string | Auto-provided by Render |
| CLOUDINARY_CLOUD_NAME | Cloudinary cloud name | your-cloud-name |
| CLOUDINARY_API_KEY | Cloudinary API key | 123456789012345 |
| CLOUDINARY_API_SECRET | Cloudinary API secret | your-secret-key |
| CORS_ALLOWED_ORIGINS | Comma-separated frontend URLs | https://frontend.com |

## Next Steps

1. Deploy your frontend to Vercel/Netlify
2. Update CORS_ALLOWED_ORIGINS with frontend URL
3. Update frontend API endpoint to point to Render backend
4. Test the complete application
5. Set up monitoring and logging

## Support

- Render Docs: https://render.com/docs
- Django Deployment: https://docs.djangoproject.com/en/5.2/howto/deployment/
- Issues: Create an issue in your GitHub repository
